WCS Production Setup

SILO A
======
Domain Name : avios-cs

http://chagall:4700/console
username - system
Password - c1ands3y

Weblogic Admin : cs-admin
Port           : 4700

ManagedServer1 : chagall_cs1
Port           : 4701

ManagedServer2 : gauguin_cs1
Port           : 4701

Cluster        : AVCSCluster

/opt/bea/user_projects/domains/avios-cs

Machine Names
=============
Type - Unix Machines
1)Chagall
Servers - csadmin,chagall_cs1
2)gauguin
Servers - gauguin_cs1


DataSources:

Database - Attempting to contact (DESCRIPTION= (ADDRESS=(PROTOCOL=TCP)(HOST=picasso)(PORT=1521)) (CONNECT_DATA= (SERVICE_NAME=CSAP)))
Schema Login - cs_owner/p4bl1SH3rA

Path - /opt/bea/user_projects/domains/avios-cs




Error occured when select the JAVA_VENDOR as Oracle.Hence changed to Sun.

Also delete the BEA_JAVA_HOME property and add the jdkhome to SUN_JAVA_HOME as below


BEA_JAVA_HOME=""
export BEA_JAVA_HOME

SUN_JAVA_HOME="/opt/jdk/jdk170_101"
export SUN_JAVA_HOME

if [ "${JAVA_VENDOR}" = "Oracle" ] ; then
        JAVA_HOME="${BEA_JAVA_HOME}"
        export JAVA_HOME
else
        if [ "${JAVA_VENDOR}" = "Sun" ] ; then
                JAVA_HOME="${SUN_JAVA_HOME}"
                export JAVA_HOME
        else
                JAVA_VENDOR="Sun"
                export JAVA_VENDOR
                JAVA_HOME="/opt/jdk/jdk170_101"
                export JAVA_HOME
        fi



		
		/opt/Ansible_WCS/Ansible_WCS_LIVE/ansible-wcs/installation
n466691@titanium>cd /opt/Ansible_WCS/Ansible_WCS_LIVE/ansible-wcs/installation


ansible-playbook -k -u p466691 -i hosts remotetest.yml --vault-password-file vault_pass.txt --step -vvvv

WCS BASELINE INSTALLATION
=========================

ansible-playbook -k -i hosts manifesto_wcs.yml --vault-password-file vault_pass.txt --step -vvvv 



   "module_stderr": "OpenSSH_6.6.1, OpenSSL 1.0.1e-fips 11 Feb 2013\r\ndebug1: Reading configuration data /etc/ssh/ssh_config\r\ndebug1: /etc/ssh/ssh_config line 56: Applying options for *\r\ndebug1: auto-mux: Trying existing master\r\ndebug2: fd 3 setting O_NONBLOCK\r\ndebug2: mux_client_hello_exchange: master version 4\r\ndebug3: mux_client_forwards: request forwardings: 0 local, 0 remote\r\ndebug3: mux_client_request_session: entering\r\ndebug3: mux_client_request_alive: entering\r\ndebug3: mux_client_request_alive: done pid = 28932\r\ndebug3: mux_client_request_session: session request sent\r\ndebug1: mux_client_request_session: master session id: 2\r\ndebug3: mux_client_read_packet: read header failed: Broken pipe\r\ndebug2: Received exit status from master 0\r\nShared connection to chagall closed.\r\n",
    "module_stdout": "/bin/sh: /usr/bin/python: not found\r\n",
    "msg": "MODULE FAILURE"

	For the above error ( as the python was not found under /usr/bin/python) as mentioned in the link below , we have added vars: and added the remote server python path in the playbook.yml
	
	https://github.com/metacloud/molecule/issues/214
	

 hosts: chagall

  vars:
    ansible_python_interpreter: /opt/csw/bin/python
	

03/August/2017 -
===============
change the Managed server entry in the start file. i.e. from GETSTATE cs$1 to GETSTATE {HOSTNAME}_cs$1
The below error occured when tried to execute sudowl ./start 1

Version mismatch between key and supported version; will try to continue
An encryption error occurred. 
Check that the correct user key file is being used to decrypt the user configuration file. 
weblogic.Admin is a command-line utility for managing WebLogic Server. Try: weblogic.Admin help LIFECYCLE Starting, stopping, discovering servers weblogic.Admin help INFO Retrieving info about WebLogic Server weblogic.Admin help JDBC Working with JDBC connection pools weblogic.Admin help MBEAN Working with WebLogic Server MBeans weblogic.Admin help CLUSTER Working with clusters weblogic.Admin help ADMINCONFIG Managing Admin configuration weblogic.Admin help ALL Help for all commands Usage: java [<SSL trust options>] weblogic.Admin [ [-url | -adminurl] [<protocol>://]<listen-address>:<port>] -username <username> [-password <password>] <COMMAND> <ARGUMENTS> More info available in the Command Reference for Oracle WebLogic Server at: http://www.oracle.com/technology/products/weblogic/index.html
Could not get JVM details - is the admin console running ?


Solution - Issue with weblogic-WebLogicConfig.properties & weblogic-WebLogicKey.properties files as i have copied them from rousseau.The production system has different password.Hence copied these two files from cms domain to resolve
the issue.

=====================	

Error Occured while running ansible play book as it is unable to create directory on chagall as weblogic user.

fatal: [chagall]: FAILED! => {
    "changed": false,
    "failed": true,
    "invocation": {
        "module_name": "file"
    },
    "module_stderr": "OpenSSH_6.6.1, OpenSSL 1.0.1e-fips 11 Feb 2013\r\n
    debug1: Reading configuration data /etc/ssh/ssh_config\r\n
    debug1: /etc/ssh/ssh_config line 56: Applying options for *\r\n
    debug1: auto-mux: Trying existing master\r\n
    debug2: fd 3 setting O_NONBLOCK\r\n
    debug2: mux_client_hello_exchange: master version 4\r\n
    debug3: mux_client_forwards: request forwardings: 0 local, 0 remote\r\n
    debug3: mux_client_request_session: entering\r\n
    debug3: mux_client_request_alive: entering\r\n
    debug3: mux_client_request_alive: done pid = 20658\r\n
    debug3: mux_client_request_session: session request sent\r\n
    debug1: mux_client_request_session: master session id: 2\r\n
    debug3: mux_client_read_packet: read header failed: Broken pipe\r\n
    debug2: Received exit status from master 1\r\nShared connection to chagall closed.\r\n",
    "module_stdout": "sudo: illegal option `-n'\r\nusage: sudo -K | -L | -V | -h | -k | -l | -v\r\nusage: sudo [-HPSb] [-p prompt] [-u username|#uid]\r\n            { -e file [...] | -i | -s | <command> }\r\n",
    "msg": "MODULE FAILURE"
	
Resoluton:

	As suggested in the link below , i have added the --ask-become-pass in the playbook command to resolve the issue.
	http://docs.ansible.com/ansible/latest/intro_adhoc.html	

ansible-playbook -k -i hosts manifesto_wcs.yml --vault-password-file vault_pass.txt --step -vvvv --ask-become-pass



Error occured while deploying cs and cas applications as the below error occured due to the wrong jndi name -

jndi/csDataSource1 - which is wrong.

java.lang.NoClassDefFoundError: org/apache/commons/dbcp/ConnectionFactory

Solution - 
jndi name should be same as datasource

Installation Of Web Center Sites Fails With "ContentServer" Failed To Pre-load (Doc ID 1643126.1)

==================================================

WCS_PATCH Installation 
=====

ansible-playbook -k -i hosts manifesto_patch.yml --vault-password-file vault_pass.txt --step -vvvv --ask-become-pass

WCS_EHCACHE Installation
=======================

ansible-playbook -k -i hosts manifesto_ehcache.yml --vault-password-file vault_pass.txt --step -vvvv --ask-become-pass

=====================================================

Initial Test - Login to CS UI

Login to CS UI failed as the server is in cluster.

ERROR [org.jasig.cas.ticket.registry.JBossCacheTicketRegistry] - java.io.InvalidClassException: org.jasig.cas.ticket.AbstractTicket; local class incompatible: stream classdesc serialVersionUID = -8506442397878267555, local class serialVersionUID = -2418635416750736300
org.jboss.cache.CacheException: java.io.InvalidClassException: org.jasig.cas.ticket.AbstractTicket; local class incompatible: stream classdesc serialVersionUID = -8506442397878267555, local class serialVersionUID = -2418635416750736300

Hence as mentioned in the Oracle KM - Can't Login To WebCenter Sites After Upgrade to CAS 4.0 (Doc ID 2098036.1).The below solution has been applied.

To implement the solution, please execute the following steps:

1. 1. Take a backup of jbossTicketCacheReplicationConfig.xml file in the bin folder 

2. Open the above file for edit and find the following line.

    <attribute name="ClusterName">TreeCache-Cluster</attribute>
3. Change the above line as below

    <attribute name="ClusterName">TreeCache-Cluster-Node1</attribute>

4. Save the file and restart the server after removing the contents of java.io.tempdir. 

5. Retest and notice the issue no longer exists.


------ restet successful.

Check the multicastaddress for all the *cache.xml files and configure a unique address per each server.

/opt/bea/user_projects/domains/avios-cs/applications/cs/WEB-INF/classes

p466691@davinci>grep multicastGroupAddress *
cas-cache.xml:            properties="peerDiscovery=automatic, multicastGroupAddress=233.0.0.0,
cs-cache.xml:            properties="peerDiscovery=automatic, multicastGroupAddress=233.0.0.0,
linked-cache.xml:            properties="peerDiscovery=automatic, multicastGroupAddress=233.0.0.0,
ss-cache.xml:            properties="peerDiscovery=automatic, multicastGroupAddress=233.0.0.0,


==================================================================================================================================================================================================================================

Now Deploying Manifesto Release for Avios - webapp , proxy etc

Last Release by Manifesto - Release R
======================================

ansible-playbook -k -i hosts --extra-vars "variable_host=chagall" manifesto_deployment.yml --vault-password-file vault_pass.txt --step -vvvv --skip-tags "data" --ask-become-pass 


Mutlicast


For Publishing the cookiename under weblogic.xml file should be changed to JSESSIONID .

run the below command to enable the sqlbased logic.
Also make sure to provide sitegod privileges to fwadmin.
sudowl java -classpath /opt/bea/user_projects/domains/avios-cs/applications/cs/WEB-INF/lib/*:/opt/bea/user_projects/domains/avios-cs/applications/cs/WEB-INF/classes/:/opt/wcs11/bin COM.FutureTense.Apps.CatalogMover -b http://chagall:4701/cs/CatalogManager -u fwadmin -p xceladmin -x import -f /var/tmp/manifesto/ElementCatalog/ElementCatalog.html


check the file modified under the below path
/opt/wcs11/wcs-shared/elements/CustomElements/OpenMarket/Xcelerate/Util

GetUrlExpressions,0.groovy


p466691@chagall>ls -lrt
total 21
-rw-r--r--   1 weblogic weblogic   10039 Aug  7 08:20 GetUrlExpressions,0.groovy
/opt/wcs11/wcs-shared/elements/CustomElements/OpenMarket/Xcelerate/Util
p466691@chagall>




==================================================

p466691@chagall>ulimit -n 1024
/var/tmp/manifesto/ElementCatalog
p466691@chagall>sudowl java -classpath /opt/bea/user_projects/domains/avios-cs/applications/cs/WEB-INF/lib/*:/opt/bea/user_projects/domains/avios-cs/applications/cs/WEB-INF/classes/:/opt/wcs11/bin COM.FutureTense.Apps.CatalogMover -b http://chagall:4701/cs/CatalogManager -u fwadmin -p xceladmin -x import -f /var/tmp/manifesto/ElementCatalog/ElementCatalog.html
Oracle WebCenter Sites 11gR1 11.1.1.8.0
Copyright (c) 2011,2013, Oracle and/or its affiliates. All Rights Reserved.

CatalogMover 11.1.1.8.0  Build Date: May 06 2016 at 05:30:42 Build Number: 276 Revision:182627

No Connections
Attempting to load ESAPI.properties via file I/O.
Attempting to load ESAPI.properties as resource file via file I/O.
Not found in 'org.owasp.esapi.resources' directory or file not readable: /var/tmp/manifesto/ElementCatalog/ESAPI.properties
Not found in SystemResource Directory/resourceDirectory: .esapi/ESAPI.properties
Not found in 'user.home' (/export/home/weblogic) directory: /export/home/weblogic/esapi/ESAPI.properties
Loading ESAPI.properties via file I/O failed. Exception was: java.io.FileNotFoundException
Attempting to load ESAPI.properties via the classpath.
SUCCESSFULLY LOADED ESAPI.properties via the CLASSPATH from '/ (root)' using current thread context class loader!
Attempting to load validation.properties via file I/O.
Attempting to load validation.properties as resource file via file I/O.
Not found in 'org.owasp.esapi.resources' directory or file not readable: /var/tmp/manifesto/ElementCatalog/validation.properties
Not found in SystemResource Directory/resourceDirectory: .esapi/validation.properties
Not found in 'user.home' (/export/home/weblogic) directory: /export/home/weblogic/esapi/validation.properties
Loading validation.properties via file I/O failed.
Attempting to load validation.properties via the classpath.
SUCCESSFULLY LOADED validation.properties via the CLASSPATH from '/ (root)' using current thread context class loader!
Connected to localhost
Loaded Catalog List from localhost
Pushing 10 rows per post
Post Results Created temporary table tt1501760476940
Added row: elementname = CustomElements/OpenMarket/Xcelerate/Util/GetUrlExpressions

07.08.2017 08:20:15 *INFO * UpdateChecker: New update(s) found: 2.6.5 [http://www.terracotta.org/confluence/display/release/Release+Notes+Ehcache+Core+2.6]. Please check http://ehcache.org for the latest version. (UpdateChecker.java, line 98)
Committed changes to catalog ElementCatalog
Deleted temporary table tt1501760476940

Successfully imported /var/tmp/manifesto/ElementCatalog/ElementCatalog.html
CatalogMover exited.
Disconnected from localhost.
07.08.2017 08:20:15 *WARN * ehcache: Running Shutdown hook for Cache Thread-4 (EhCacheObjectCache.java, line 577)
07.08.2017 08:20:15 *WARN * ehcache: Completed running Shutdown hook for Cache Thread-4 (EhCacheObjectCache.java, line 579)
/var/tmp/manifesto/ElementCatalog

===========================================================================



After successful publishing - copy the wcs11 from chagall to gauguin.Make sure to modify the host entries under the below files.Also change the ipaddress under 
CAS cluster member is not starting up correctly (Doc ID 1473628.1)



testing - SILOA
=================


issues encountered as Market Drop down and sign in page were not working for all the markets.

Issue was with the localhost configured in avios-cms properties under /opt/wcs11/bin...as the listen-address for chagall_cs1 was configured as chagall instead of all host addresses...Have removed the <listen-address> entry in
config.xml under chagall_cs1 section to resolve the issue.

SearchFilght issue - rest-template-connection-configurations.xml copied from rousseau to SILOA.

path - /opt/bea/user_projects/domains/avios-cs/applications/cs/WEB-INF/classes





